# ==============================================
# Environment Variables - PMP Platform (EXAMPLE)
# ==============================================
# ⚠️ COPY THIS FILE TO .env AND FILL WITH REAL VALUES
# DO NOT commit .env to version control!

# ==============================================
# DATABASE CREDENTIALS
# ==============================================
POSTGRES_DB=pmp_db
POSTGRES_USER=pmp_user
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
POSTGRES_INITDB_ARGS=--encoding=UTF8 --locale=en_US.UTF-8
PGDATA=/var/lib/postgresql/data/pgdata

# ==============================================
# REDIS CREDENTIALS
# ==============================================
REDIS_PASSWORD=CHANGE_ME_STRONG_REDIS_PASSWORD

# ==============================================
# PGADMIN CREDENTIALS
# ==============================================
PGADMIN_DEFAULT_EMAIL=admin@pmp.local
PGADMIN_DEFAULT_PASSWORD=CHANGE_ME_PGADMIN_PASSWORD
PGADMIN_LISTEN_PORT=80

# ==============================================
# API GATEWAY - CRITICAL SECURITY SETTINGS
# ==============================================
NODE_ENV=development
# CRITICAL: Generate with: openssl rand -base64 64
JWT_SECRET=CHANGE_ME_GENERATE_STRONG_SECRET_MIN_32_CHARS
INTERNAL_HSM_SECRET=CHANGE_ME_INTERNAL_HSM_SHARED_SECRET
JWT_EXPIRES_IN=2h
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# CORS Configuration (comma-separated origins for production)
# Example: CORS_ORIGIN=https://app.example.com,https://www.example.com
CORS_ORIGIN=http://localhost:3000,http://localhost:5173
# For single-domain Nginx deployment: CORS_ORIGIN=https://example.com

# Public frontend/backend URLs (override for internet deployment)
# Example:
# NEXT_PUBLIC_API_URL=https://example.com
# NEXT_PUBLIC_PORTAL_URL=https://example.com/merchant
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_PORTAL_URL=http://localhost:3000
NEXT_PUBLIC_TPE_URL=http://localhost:3001
NEXT_PUBLIC_USER_CARDS_URL=http://localhost:3004
NEXT_PUBLIC_HSM_URL=http://localhost:3006
NEXT_PUBLIC_MONITORING_URL=http://localhost:3082

# CTF AttackBox web terminal URL (student labs)
NEXT_PUBLIC_CTF_ATTACKBOX_URL=http://localhost:7681

# ==============================================
# CTF LAB SESSIONS (THM-LIKE)
# ==============================================
# Session lifecycle and capacity
LAB_MAX_ACTIVE_SESSIONS=20
LAB_DEFAULT_TTL_MINUTES=120
LAB_EXTENSION_MINUTES=60
LAB_MAX_EXTENSIONS=1
LAB_MAINTENANCE_INTERVAL_MS=30000
LAB_RECONCILE_INTERVAL_MS=120000
LAB_PROVISIONING_TIMEOUT_MINUTES=10

# Session network allocation
LAB_NETWORK_BASE_CIDR=10.60.0.0/16
LAB_NETWORK_SUBNET_PREFIX=28

# SLO targets (MVP baseline)
LAB_SLO_START_P95_MS=25000
LAB_SLO_STOP_P95_MS=20000

# Internal service wiring
LAB_ORCHESTRATOR_URL=http://lab-orchestrator:8098
LAB_ORCHESTRATOR_SECRET=CHANGE_ME_LAB_ORCHESTRATOR_SECRET
LAB_ACCESS_PROXY_URL=http://lab-access-proxy:8099
INTERNAL_LAB_PROXY_URL=http://lab-access-proxy:8099
LAB_ACCESS_PROXY_BASE_PATH=/lab
LAB_INTERNAL_PROXY_SECRET=CHANGE_ME_LAB_PROXY_INTERNAL_SECRET
LAB_PROXY_CACHE_TTL_MS=15000

# Let's Encrypt certificate configuration (production HTTPS)
# Use staging (1) first to avoid rate limits, then set to 0.
LETSENCRYPT_EMAIL=admin@example.com
LETSENCRYPT_DOMAINS=example.com,www.example.com
LETSENCRYPT_CERT_NAME=pmp
LETSENCRYPT_STAGING=1

# Service Authentication Token
SERVICE_AUTH_TOKEN=CHANGE_ME_SERVICE_TOKEN

# ==============================================
# MONITORING
# ==============================================
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD
GF_INSTALL_PLUGINS=redis-datasource
GF_SERVER_ROOT_URL=http://localhost:3002

# ==============================================
# SECURITY ALGORITHMS
# ==============================================
PIN_ENCRYPTION_ALGORITHM=3DES
MAC_ALGORITHM=HMAC-SHA256

# ==============================================
# FRAUD DETECTION THRESHOLDS
# ==============================================
FRAUD_THRESHOLD_LOW=30
FRAUD_THRESHOLD_MEDIUM=60
FRAUD_THRESHOLD_HIGH=80

# ==============================================
# KEY MANAGEMENT
# ==============================================
KEY_ROTATION_INTERVAL_DAYS=90
LMK_KEY_FILE=/app/keys/lmk.key
MASTER_KEY_FILE=/app/keys/master.key

# ==============================================
# LOGGING
# ==============================================
LOG_LEVEL=debug

# ==============================================
# CONSTRUCTED URLS (internal)
# ==============================================
# Service URLs (Localhost for development)
CARD_SERVICE_URL=http://localhost:8001
POS_SERVICE_URL=http://localhost:8002
ACQUIRER_SERVICE_URL=http://localhost:8003
NETWORK_SWITCH_URL=http://localhost:8004
ISSUER_SERVICE_URL=http://localhost:8005
AUTH_ENGINE_URL=http://localhost:8006
FRAUD_DETECTION_URL=http://localhost:8007
CRYPTO_SERVICE_URL=http://localhost:8010
HSM_SIMULATOR_URL=http://localhost:8011
KEY_MANAGEMENT_URL=http://localhost:8012

DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5435/${POSTGRES_DB}
REDIS_URL=redis://:${REDIS_PASSWORD}@localhost:6379

# ==============================================
# HOW TO GENERATE STRONG SECRETS
# ==============================================
# JWT_SECRET: openssl rand -base64 64
# POSTGRES_PASSWORD: openssl rand -base64 32
# REDIS_PASSWORD: openssl rand -base64 32
# SERVICE_AUTH_TOKEN: openssl rand -hex 32
