export type CtfCategory =
    | 'PIN_CRACKING'
    | 'REPLAY_ATTACK'
    | 'MITM'
    | 'FRAUD_CNP'
    | 'ISO8583_MANIPULATION'
    | 'HSM_ATTACK'
    | '3DS_BYPASS'
    | 'CRYPTO_WEAKNESS'
    | 'PRIVILEGE_ESCALATION';

export type CtfDifficulty = 'BEGINNER' | 'INTERMEDIATE' | 'ADVANCED' | 'EXPERT';

export type CtfStepType =
    | 'EXPLANATION'
    | 'CURL_COMMAND'
    | 'CODE_SNIPPET'
    | 'OBSERVATION'
    | 'ANALYSIS'
    | 'EXPLOITATION';

export interface CtfGuidedStepSeed {
    stepNumber: number;
    stepTitle: string;
    stepDescription: string;
    stepType: CtfStepType;
    commandTemplate?: string;
    expectedOutput?: string;
    hintText?: string;
}

export interface CtfHintSeed {
    hintNumber: number;
    hintText: string;
    costPoints: number;
}

export interface CtfChallengeSeed {
    code: string;
    title: string;
    description: string;
    freeModeDescription: string;
    category: CtfCategory;
    difficulty: CtfDifficulty;
    points: number;
    flagValue: string;
    prerequisiteChallengeCode?: string;
    targetService: string;
    targetEndpoint: string;
    vulnerabilityType: string;
    attackVector: string;
    learningObjectives: string[];
    estimatedMinutes: number;
    isActive: boolean;
    relatedWorkshopPath?: string;
    guidedSteps: CtfGuidedStepSeed[];
    hints: CtfHintSeed[];
}

const steps = (cmd?: string): CtfGuidedStepSeed[] => [
    {
        stepNumber: 1,
        stepTitle: 'Recon',
        stepDescription: 'Identifier la surface d attaque.',
        stepType: 'EXPLANATION',
    },
    {
        stepNumber: 2,
        stepTitle: cmd ? 'Commande' : 'Action',
        stepDescription: cmd ? 'Executer la requete.' : 'Executer la manipulation.',
        stepType: cmd ? 'CURL_COMMAND' : 'EXPLOITATION',
        commandTemplate: cmd,
    },
    {
        stepNumber: 3,
        stepTitle: 'Observation',
        stepDescription: 'Observer la preuve de vuln.',
        stepType: 'OBSERVATION',
    },
    {
        stepNumber: 4,
        stepTitle: 'Analyse',
        stepDescription: 'Expliquer l impact securite.',
        stepType: 'ANALYSIS',
    },
    {
        stepNumber: 5,
        stepTitle: 'Flag',
        stepDescription: 'Soumettre PMP{...}.',
        stepType: 'EXPLOITATION',
    },
];

const hints = (h1: string, h2: string): CtfHintSeed[] => [
    { hintNumber: 1, hintText: h1, costPoints: 10 },
    { hintNumber: 2, hintText: h2, costPoints: 15 },
];

export const CTF_CHALLENGES: CtfChallengeSeed[] = [
    {
        code: 'HSM-001',
        title: 'Le Coffre Ouvert',
        description: 'GET /hsm/keys expose des cles sans auth.',
        freeModeDescription: 'Explorez les endpoints admin HSM.',
        category: 'HSM_ATTACK',
        difficulty: 'BEGINNER',
        points: 100,
        flagValue: 'PMP{HSM_KEYS_NO_AUTH}',
        targetService: 'hsm-simulator',
        targetEndpoint: 'GET http://localhost:8011/hsm/keys',
        vulnerabilityType: 'Broken access control',
        attackVector: 'Endpoint enumeration',
        learningObjectives: ['Trouver un endpoint non protege', 'Mesurer la fuite de cles'],
        estimatedMinutes: 15,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s http://localhost:8011/hsm/keys'),
        hints: hints('Explorez les endpoints GET HSM.', 'Essayez /hsm/keys.'),
    },
    {
        code: 'HSM-002',
        title: 'Cles Previsibles',
        description: 'Une ZPK de test est triviale.',
        freeModeDescription: 'Cherchez une cle par defaut faible.',
        category: 'HSM_ATTACK',
        difficulty: 'INTERMEDIATE',
        points: 150,
        flagValue: 'PMP{ZPK_11111111111111111111111111111111}',
        prerequisiteChallengeCode: 'HSM-001',
        targetService: 'hsm-simulator',
        targetEndpoint: 'backend/hsm-simulator/src/core/KeyStorage.ts',
        vulnerabilityType: 'Weak keys',
        attackVector: 'Default seed inspection',
        learningObjectives: ['Identifier un pattern de cle faible', 'Relier a risque PIN'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s http://localhost:8011/hsm/keys'),
        hints: hints('Inspectez ZPK_TEST.', 'La valeur est un motif repete.'),
    },
    {
        code: 'HSM-003',
        title: 'Fuite dans les Logs',
        description: 'keyLeakInLogs logge du materiel sensible.',
        freeModeDescription: 'Activez le mode debug vuln et observez.',
        category: 'HSM_ATTACK',
        difficulty: 'INTERMEDIATE',
        points: 200,
        flagValue: 'PMP{KEY_LEAK_IN_LOGS}',
        prerequisiteChallengeCode: 'HSM-002',
        targetService: 'hsm-simulator',
        targetEndpoint: 'POST /hsm/config + operations HSM',
        vulnerabilityType: 'Sensitive logging',
        attackVector: 'Debug misconfiguration',
        learningObjectives: ['Activer config vuln', 'Detecter fuite logs'],
        estimatedMinutes: 25,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s -X POST http://localhost:8011/hsm/config -H "Content-Type: application/json" -d "{\"vulnerabilities\":{\"keyLeakInLogs\":true}}"'),
        hints: hints('Le body attend vulnerabilities.keyLeakInLogs.', 'Cherchez [VULN:LEAK] dans les logs.'),
    },
    {
        code: 'HSM-004',
        title: 'Le Pingouin ECB',
        description: 'Le mode ECB fuit les patterns.',
        freeModeDescription: 'Testez le chiffrement avec donnees repetitives.',
        category: 'HSM_ATTACK',
        difficulty: 'ADVANCED',
        points: 250,
        flagValue: 'PMP{ECB_LEAKS_PATTERNS}',
        prerequisiteChallengeCode: 'HSM-003',
        targetService: 'hsm-simulator',
        targetEndpoint: 'POST /hsm/encrypt-data',
        vulnerabilityType: 'Insecure cipher mode',
        attackVector: 'Block pattern analysis',
        learningObjectives: ['Comparer ECB/CBC', 'Prouver fuite structurelle'],
        estimatedMinutes: 30,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s -X POST http://localhost:8011/hsm/encrypt-data -H "Content-Type: application/json" -d "{\"data\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"keyLabel\":\"DEK_AES_001\",\"mode\":\"ECB\"}"'),
        hints: hints('Passez mode=ECB.', 'Utilisez une donnee repetee.'),
    },
    {
        code: 'HSM-005',
        title: 'Course contre la Montre',
        description: 'Verification MAC exposable via timing.',
        freeModeDescription: 'Mesurez les temps de verify-mac.',
        category: 'HSM_ATTACK',
        difficulty: 'EXPERT',
        points: 350,
        flagValue: 'PMP{TIMING_ATTACK_MAC}',
        prerequisiteChallengeCode: 'HSM-004',
        targetService: 'hsm-simulator',
        targetEndpoint: 'POST /hsm/verify-mac',
        vulnerabilityType: 'Timing side-channel',
        attackVector: 'Latency correlation',
        learningObjectives: ['Mesurer timings', 'Conclure non constant-time'],
        estimatedMinutes: 40,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s -X POST http://localhost:8011/hsm/verify-mac -H "Content-Type: application/json" -d "{\"data\":\"PAYLOAD\",\"keyLabel\":\"ZAK_002\",\"mac\":\"0011223344556677\"}"'),
        hints: hints('Multipliez les mesures.', 'Comparez des prefixes de MAC.'),
    },
    {
        code: 'REPLAY-001',
        title: 'Deja Vu',
        description: 'Rejeu possible sans nonce robuste.',
        freeModeDescription: 'Rejouez exactement la meme requete.',
        category: 'REPLAY_ATTACK',
        difficulty: 'BEGINNER',
        points: 100,
        flagValue: 'PMP{REPLAY_NO_NONCE}',
        targetService: 'hsm-simulator',
        targetEndpoint: 'POST /hsm/config (allowReplay)',
        vulnerabilityType: 'Replay protection missing',
        attackVector: 'Identical payload replay',
        learningObjectives: ['Comprendre anti-rejeu', 'Prouver double execution'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/iso8583',
        guidedSteps: steps('curl -s -X POST http://localhost:8011/hsm/config -H "Content-Type: application/json" -d "{\"vulnerabilities\":{\"allowReplay\":true}}"'),
        hints: hints('Activez allowReplay.', 'Conservez transactionId/STAN identiques.'),
    },
    {
        code: 'REPLAY-002',
        title: 'Reset et Recommence',
        description: 'Compteurs velocity en memoire non persistants.',
        freeModeDescription: 'Testez avant/apres restart du service fraude.',
        category: 'REPLAY_ATTACK',
        difficulty: 'INTERMEDIATE',
        points: 150,
        flagValue: 'PMP{VELOCITY_MEMORY_ONLY}',
        prerequisiteChallengeCode: 'REPLAY-001',
        targetService: 'sim-fraud-detection',
        targetEndpoint: 'POST http://localhost:8007/check',
        vulnerabilityType: 'Volatile state',
        attackVector: 'Service restart bypass',
        learningObjectives: ['Prouver perte des compteurs', 'Relier a contournement velocity'],
        estimatedMinutes: 25,
        isActive: true,
        relatedWorkshopPath: '/workshops/fraud-detection',
        guidedSteps: steps('curl -s -X POST http://localhost:8007/check -H "Content-Type: application/json" -d "{\"pan\":\"4111111111111111\",\"amount\":50,\"merchantId\":\"M1\",\"mcc\":\"5411\"}"'),
        hints: hints('transactionHistory est en memoire.', 'Redemarrer reset la map.'),
    },
    {
        code: '3DS-001',
        title: 'Le Numero Magique',
        description: 'OTP 123456 accepte systematiquement.',
        freeModeDescription: 'Testez un OTP universel.',
        category: '3DS_BYPASS',
        difficulty: 'BEGINNER',
        points: 100,
        flagValue: 'PMP{OTP_123456_HARDCODED}',
        targetService: 'acs-simulator',
        targetEndpoint: 'POST http://localhost:8013/challenge/verify',
        vulnerabilityType: 'Hardcoded OTP',
        attackVector: 'Static code abuse',
        learningObjectives: ['Detecter OTP hardcode', 'Evaluer bypass 3DS'],
        estimatedMinutes: 15,
        isActive: true,
        relatedWorkshopPath: '/workshops/3ds-flow',
        guidedSteps: steps('curl -s -X POST http://localhost:8013/challenge/verify -H "Content-Type: application/json" -d "{\"acsTransId\":\"ACS_TEST\",\"otp\":\"123456\"}"'),
        hints: hints('Regardez verifyChallenge.', 'Essayez 123456.'),
    },
    {
        code: '3DS-002',
        title: 'Le Mot de Passe',
        description: 'cardholderName=SUCCESS force transStatus Y.',
        freeModeDescription: 'Cherchez une valeur magique business.',
        category: '3DS_BYPASS',
        difficulty: 'INTERMEDIATE',
        points: 150,
        flagValue: 'PMP{CARDHOLDER_NAME_BYPASS}',
        prerequisiteChallengeCode: '3DS-001',
        targetService: 'acs-simulator',
        targetEndpoint: 'POST http://localhost:8013/authenticate',
        vulnerabilityType: 'Logic backdoor',
        attackVector: 'Magic string injection',
        learningObjectives: ['Trouver une backdoor logique', 'Bypass frictionless/challenge'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/3ds-flow',
        guidedSteps: steps('curl -s -X POST http://localhost:8013/authenticate -H "Content-Type: application/json" -d "{\"pan\":\"4111111111111111\",\"amount\":600,\"currency\":\"EUR\",\"merchantId\":\"M123\",\"transactionId\":\"TX-3DS-2\",\"cardholderName\":\"SUCCESS\"}"'),
        hints: hints('Condition sur cardholderName.', 'Valeur magique SUCCESS.'),
    },
    {
        code: '3DS-003',
        title: 'Juste en Dessous',
        description: 'Bypass SCA via montant sous seuil.',
        freeModeDescription: 'Comparez 500 vs 499.99.',
        category: '3DS_BYPASS',
        difficulty: 'INTERMEDIATE',
        points: 200,
        flagValue: 'PMP{THRESHOLD_499_NO_SCA}',
        prerequisiteChallengeCode: '3DS-002',
        targetService: 'api-gateway orchestrator',
        targetEndpoint: 'POST /api/transaction/process',
        vulnerabilityType: 'Static threshold bypass',
        attackVector: 'Sub-threshold amount crafting',
        learningObjectives: ['Tester seuil SCA', 'Prouver contournement metier'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/3ds-flow',
        guidedSteps: steps('curl -s -X POST http://localhost:8000/api/transaction/process -H "Content-Type: application/json" -d "{\"pan\":\"4111111111111111\",\"amount\":499.99,\"currency\":\"EUR\",\"merchantId\":\"M123\",\"terminalId\":\"WEB001\",\"isEcommerce\":true}"'),
        hints: hints('Le seuil default est 500.', 'Testez 499.99 en ecommerce.'),
    },
    {
        code: 'FRAUD-001',
        title: 'Quand la Fraude Dort',
        description: 'Fraud service down => fallback LOW risk.',
        freeModeDescription: 'Que se passe-t-il quand le service fraude est indisponible ?',
        category: 'FRAUD_CNP',
        difficulty: 'INTERMEDIATE',
        points: 200,
        flagValue: 'PMP{FRAUD_SERVICE_FAIL_OPEN}',
        targetService: 'api-gateway orchestrator',
        targetEndpoint: 'POST /api/transaction/process',
        vulnerabilityType: 'Fail-open decisioning',
        attackVector: 'Dependency outage',
        learningObjectives: ['Comparer fail-open/fail-closed', 'Mesurer impact du fallback'],
        estimatedMinutes: 30,
        isActive: true,
        relatedWorkshopPath: '/workshops/fraud-detection',
        guidedSteps: steps('curl -s -X POST http://localhost:8000/api/transaction/process -H "Content-Type: application/json" -d "{\"pan\":\"4111111111111111\",\"amount\":1500,\"currency\":\"EUR\",\"merchantId\":\"M999\",\"terminalId\":\"WEB001\",\"isEcommerce\":true}"'),
        hints: hints('Inspectez checkFraud dans orchestrator.', 'Le fallback retourne riskScore=0.'),
    },
    {
        code: 'FRAUD-002',
        title: 'Score Optimise',
        description: 'Contourner les seuils en restant juste sous 70.',
        freeModeDescription: 'Fabriquez une transaction qui ne passe pas en DECLINE.',
        category: 'FRAUD_CNP',
        difficulty: 'ADVANCED',
        points: 250,
        flagValue: 'PMP{FRAUD_SCORE_GAMING}',
        prerequisiteChallengeCode: 'FRAUD-001',
        targetService: 'sim-fraud-detection',
        targetEndpoint: 'POST http://localhost:8007/check',
        vulnerabilityType: 'Threshold gaming',
        attackVector: 'Rule combination abuse',
        learningObjectives: ['Comprendre le score', 'Construire un cas evasif'],
        estimatedMinutes: 35,
        isActive: true,
        relatedWorkshopPath: '/workshops/fraud-detection',
        guidedSteps: steps('curl -s -X POST http://localhost:8007/check -H "Content-Type: application/json" -d "{\"pan\":\"5555555555554444\",\"amount\":999,\"merchantId\":\"M900\",\"mcc\":\"5411\",\"country\":\"FR\"}"'),
        hints: hints('Seuil HIGH=70.', 'Evitez MCC suspects et pays bloques.'),
    },
    {
        code: 'ISO-001',
        title: 'Table de Routage Exposee',
        description: 'BIN table lisible sans auth.',
        freeModeDescription: 'Interrogez les endpoints debug du switch.',
        category: 'ISO8583_MANIPULATION',
        difficulty: 'BEGINNER',
        points: 100,
        flagValue: 'PMP{BIN_TABLE_NO_AUTH}',
        targetService: 'sim-network-switch',
        targetEndpoint: 'GET http://localhost:8004/transaction/bin-table',
        vulnerabilityType: 'Information disclosure',
        attackVector: 'Unauthenticated debug endpoint',
        learningObjectives: ['Voir la topologie BIN', 'Mesurer fuite architecture'],
        estimatedMinutes: 15,
        isActive: true,
        relatedWorkshopPath: '/workshops/iso8583',
        guidedSteps: steps('curl -s http://localhost:8004/transaction/bin-table'),
        hints: hints('Cherchez le endpoint bin-table.', 'Aucune auth sur la route.'),
    },
    {
        code: 'ISO-002',
        title: 'Montant Maximum',
        description: 'Le schema accepte 999,999,999.99.',
        freeModeDescription: 'Testez la limite haute amount.',
        category: 'ISO8583_MANIPULATION',
        difficulty: 'INTERMEDIATE',
        points: 150,
        flagValue: 'PMP{MAX_AMOUNT_999M}',
        prerequisiteChallengeCode: 'ISO-001',
        targetService: 'sim-network-switch',
        targetEndpoint: 'POST http://localhost:8004/transaction',
        vulnerabilityType: 'Weak business validation',
        attackVector: 'Boundary abuse',
        learningObjectives: ['Tester bornes', 'Comparer limites techniques vs metier'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/iso8583',
        guidedSteps: steps('curl -s -X POST http://localhost:8004/transaction -H "Content-Type: application/json" -d "{\"mti\":\"0100\",\"pan\":\"4111111111111111\",\"processingCode\":\"000000\",\"amount\":999999999.99,\"currency\":\"EUR\",\"transmissionDateTime\":\"0101120000\",\"localTransactionTime\":\"120000\",\"localTransactionDate\":\"0101\",\"stan\":\"123456\",\"terminalId\":\"TERM0001\",\"merchantId\":\"M123\",\"merchantCategoryCode\":\"5411\",\"expiryDate\":\"2612\",\"posEntryMode\":\"010\",\"acquirerReferenceNumber\":\"ARN1234567890123456789\"}"'),
        hints: hints('Inspectez validation.ts.', 'La borne max est tres elevee.'),
    },
    {
        code: 'PIN-001',
        title: 'Le Fallback Silencieux',
        description: 'Erreur HSM => PIN accepte en simulation.',
        freeModeDescription: 'Testez authorize quand le HSM est indisponible.',
        category: 'PIN_CRACKING',
        difficulty: 'ADVANCED',
        points: 250,
        flagValue: 'PMP{HSM_DOWN_PIN_BYPASS}',
        targetService: 'sim-issuer-service',
        targetEndpoint: 'POST http://localhost:8005/authorize',
        vulnerabilityType: 'Auth bypass on dependency failure',
        attackVector: 'Fail-open PIN validation',
        learningObjectives: ['Voir fallback dangereux', 'Exiger fail-closed PIN'],
        estimatedMinutes: 35,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps('curl -s -X POST http://localhost:8005/authorize -H "Content-Type: application/json" -d "{\"transactionId\":\"PIN1\",\"pan\":\"4111111111111111\",\"amount\":10,\"currency\":\"EUR\",\"merchantId\":\"M123\",\"mcc\":\"5411\",\"transactionType\":\"PURCHASE\",\"pinBlock\":\"FFFFFFFFFFFFFFFF\"}"'),
        hints: hints('Cherchez decryptPinBlock.', 'En catch, success=true est force.'),
    },
    {
        code: 'PIN-002',
        title: 'Random Previsible',
        description: 'Math.random utilise pour padding PIN block.',
        freeModeDescription: 'Auditez la generation des blocs PIN.',
        category: 'PIN_CRACKING',
        difficulty: 'EXPERT',
        points: 300,
        flagValue: 'PMP{MATH_RANDOM_NOT_CRYPTO}',
        prerequisiteChallengeCode: 'PIN-001',
        targetService: 'crypto-edu',
        targetEndpoint: 'backend/crypto-edu/src/algorithms/pin/PINBlockGenerator.ts',
        vulnerabilityType: 'Insecure random',
        attackVector: 'PRNG inspection',
        learningObjectives: ['Differencier PRNG/CSPRNG', 'Proposer randomBytes'],
        estimatedMinutes: 40,
        isActive: true,
        relatedWorkshopPath: '/workshops/hsm-keys',
        guidedSteps: steps(),
        hints: hints('Regardez les formats 1/3/4.', 'Math.random est present dans le padding.'),
    },
    {
        code: 'MITM-001',
        title: 'Le CVV Voyageur',
        description: 'Le CVV circule en clair dans des payloads applicatifs.',
        freeModeDescription: 'Suivez le champ CVV dans le flux POS->acquirer.',
        category: 'MITM',
        difficulty: 'INTERMEDIATE',
        points: 200,
        flagValue: 'PMP{CVV_TRANSMITTED_PLAINTEXT}',
        targetService: 'sim-pos-service/sim-acquirer-service',
        targetEndpoint: 'POST http://localhost:8002/transaction',
        vulnerabilityType: 'Sensitive data in transit',
        attackVector: 'Payload interception',
        learningObjectives: ['Identifier champ PCI sensible', 'Limiter la propagation du CVV'],
        estimatedMinutes: 30,
        isActive: true,
        relatedWorkshopPath: '/workshops/iso8583',
        guidedSteps: steps('curl -s -X POST http://localhost:8002/transaction -H "Content-Type: application/json" -d "{\"pan\":\"4111111111111111\",\"amount\":50,\"currency\":\"EUR\",\"merchantId\":\"M123\",\"transactionType\":\"PURCHASE\",\"cvv\":\"123\",\"expiryMonth\":12,\"expiryYear\":2026}"'),
        hints: hints('Le champ cvv est dans le payload acquirer.', 'PCI-DSS interdit retention/transit inutile du CVV.'),
    },
    {
        code: 'PRIV-001',
        title: 'Le Compte en Banque Infini',
        description: 'PATCH balance issuer sans auth.',
        freeModeDescription: 'Modifiez un solde sans credentials.',
        category: 'PRIVILEGE_ESCALATION',
        difficulty: 'ADVANCED',
        points: 300,
        flagValue: 'PMP{BALANCE_UPDATE_NO_AUTH}',
        targetService: 'sim-issuer-service',
        targetEndpoint: 'PATCH http://localhost:8005/accounts/:pan/balance',
        vulnerabilityType: 'Missing authorization',
        attackVector: 'Direct admin endpoint call',
        learningObjectives: ['Verifier absence RBAC', 'Mesurer impact integrite financiere'],
        estimatedMinutes: 30,
        isActive: true,
        relatedWorkshopPath: '/workshops/intro',
        guidedSteps: steps('curl -s -X PATCH http://localhost:8005/accounts/4111111111111111/balance -H "Content-Type: application/json" -d "{\"balance\":999999}"'),
        hints: hints('Route PATCH /accounts/:pan/balance.', 'Aucune auth middleware sur issuer.'),
    },
    {
        code: 'CRYPTO-001',
        title: 'Token Predictible',
        description: 'Generation token basee sur Math.random.',
        freeModeDescription: 'Audit du tokenVault.',
        category: 'CRYPTO_WEAKNESS',
        difficulty: 'BEGINNER',
        points: 120,
        flagValue: 'PMP{TOKEN_MATH_RANDOM}',
        targetService: 'tokenization-service',
        targetEndpoint: 'backend/tokenization-service/src/services/tokenVault.ts',
        vulnerabilityType: 'Weak random source',
        attackVector: 'Code audit',
        learningObjectives: ['Detecter source random faible', 'Proposer CSPRNG'],
        estimatedMinutes: 20,
        isActive: true,
        relatedWorkshopPath: '/workshops/session-security',
        guidedSteps: steps(),
        hints: hints('Inspectez variable middle.', 'Le generateur utilise Math.random.'),
    },
    {
        code: 'CRYPTO-002',
        title: 'Auth Code Guessable',
        description: 'Auth code issuer derive de Math.random.',
        freeModeDescription: 'Auditez generateAuthCode.',
        category: 'CRYPTO_WEAKNESS',
        difficulty: 'ADVANCED',
        points: 220,
        flagValue: 'PMP{AUTH_CODE_WEAK_PRNG}',
        prerequisiteChallengeCode: 'CRYPTO-001',
        targetService: 'sim-issuer-service',
        targetEndpoint: 'backend/sim-issuer-service/src/services/issuer.service.ts',
        vulnerabilityType: 'Predictable auth code generation',
        attackVector: 'Code audit',
        learningObjectives: ['Trouver PRNG faible', 'Proposer generation robuste'],
        estimatedMinutes: 25,
        isActive: true,
        relatedWorkshopPath: '/workshops/intro',
        guidedSteps: steps(),
        hints: hints('Cherchez generateAuthCode.', 'Math.random + substring(2,8).'),
    },
];

export const CTF_CHALLENGES_BY_CODE = new Map(CTF_CHALLENGES.map((challenge) => [challenge.code, challenge]));

export const CTF_TOTAL_ACTIVE_CHALLENGES = CTF_CHALLENGES.filter((challenge) => challenge.isActive).length;
